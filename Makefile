.SILENT:


#--------------------------------------------------------------------------------------------------
ASM      := nasm
COMPILER := g++
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
SRC_DIR   := src/
HDR_DIR   := headers/
OBJ_DIR   := obj/
BIN       := myPrintf
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
CFLAGS    := -std=c++17 -Wall -Wextra -O2 -no-pie 
ASMFLAGS  := -f elf64 -g -F dwarf
LDFLAGS   := -Wl,-z,noexecstack
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
ASM_SRCS  := $(wildcard $(SRC_DIR)/*.s)
CPP_SRCS  := $(wildcard $(SRC_DIR)/*.cpp)

ASM_OBJS  := $(patsubst $(SRC_DIR)/%.s,$(OBJ_DIR)/%.o,$(ASM_SRCS))
CPP_OBJS  := $(patsubst $(SRC_DIR)/%.cpp,$(OBJ_DIR)/%.o,$(CPP_SRCS))

OBJS      := $(ASM_OBJS) $(CPP_OBJS)
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
run: $(BIN)
	./$(BIN)
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
clean:
	rm -rf $(OBJ_DIR) $(BIN)
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.s | $(OBJ_DIR)
	$(ASM) $(ASMFLAGS) $< -o $@

$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp | $(OBJ_DIR)
	$(COMPILER) $(CFLAGS) -I$(HDR_DIR) -c $< -o $@
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
$(BIN): $(OBJS) | $(OBJ_DIR)
	$(COMPILER) $(CFLAGS) $(LDFLAGS) $^ -o $@
#--------------------------------------------------------------------------------------------------


#--------------------------------------------------------------------------------------------------
$(OBJ_DIR):
	mkdir -p $@
#--------------------------------------------------------------------------------------------------

